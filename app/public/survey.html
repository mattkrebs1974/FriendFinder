<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>

  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- Font Awesome Glyphicons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

    <!-- Chosen -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

</head>

<body>

    <div class="container">

        <h2>Survey Questions</h2>
        <hr>

        <h3><strong>About You</strong></h3>
        <h4>Name (Required)</h4>
        <input type="text" id="name" class="form-control" required>

        <h4>Link to Photo Image (Required)</h4>
        <input type="text" id="photo" class="form-control" required>

        <hr>

        <h3><strong>Question 1</strong></h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <select class="chosen-select" id="q1">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 2</strong></h3>
        <h4>Generally speaking, you rely more on your experience than your imagination.</h4>
        <select class="chosen-select" id="q2">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>


        <h3><strong>Question 3</strong></h3>
        <h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
        <select class="chosen-select" id="q3">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>


        <h3><strong>Question 4</strong></h3>
        <h4>You rarely do something just out of sheer curiosity.</h4>
        <select class="chosen-select" id="q4">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>


        <h3><strong>Question 5</strong></h3>
        <h4>People can rarely upset you.</h4>
        <select class="chosen-select" id="q5">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>


        <h3><strong>Question 6</strong></h3>
        <h4>It is often difficult for you to relate to other people’s feelings.</h4>
        <select class="chosen-select" id="q6">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>


        <h3><strong>Question 7</strong></h3>
        <h4>In a discussion, truth should be more important than people’s sensitivities.</h4>
        <select class="chosen-select" id="q7">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 8</strong></h3>
        <h4>You rarely get carried away by fantasies and ideas.</h4>
        <select class="chosen-select" id="q8">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 9</strong></h3>
        <h4>You think that everyone’s views should be respected regardless of whether they are supported by facts or
            not.</h4>
        <select class="chosen-select" id="q9">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 10</strong></h3>
        <h4>You feel more energetic after spending time with a group of people.</h4>
        <select class="chosen-select" id="q10">
            <option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>

        <br>
        <br>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle"
                aria-hidden="true"></i>
            Submit</button>

        <hr>
        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends">API Friends List</a> | <a
                        href=" https://github.com/mattkrebs1974/FriendFinder">GitHub Repo</a></p>
            </div>
        </footer>

    </div>


<div class="matchModal" class="d-flex justify-content-center">
    <div id="matchModal" class="modal fade" role="dialog" >
        <div class="modal-dialog" role="content">
            <div class="modal-content" style="width: 500px;  margin-left:auto; margin-right:auto;">
                <div class="modal-header" style="background:black;">
                    <h1 class="modal-title" style="color:dodgerblue;float: left;"> Your New '80s' Friend</h1>
                    <button id="clearButton" type="button" class="close" data-dismiss="modal" style="color:dodgerblue; float: right;">&times;</button>
                </div>
                <div class="modal-body" style="width:500px; background-color:#323232">
                    <div class="d-flex justify-content-center">
                        <div class="container" style="width:450px;">
                            <div class="row row-content" style="width:450px;">
                                <div class="col" style="width:450px;">
                                    <div class="modal-body" style="text-align: left; color:dodgerblue; width:450px;">
                                        <h2 id="match-name" style="margin-top:-20px;"></h2>
                                        <img id="match-img" style="width:420px" alt="The person you match best with didn't post a photo.">
                                    
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal" style="color:dodgerblue; background-color: black;">Close</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>




    <script type="text/javascript">
       
        var config = {
            ".chosen-select": {},
            ".chosen-select-deselect": {
                allow_single_deselect: true
            },
            ".chosen-select-no-single": {
                disable_search_threshold: 10
            },
            ".chosen-select-no-results": {
                no_results_text: "Oops, nothing found!"
            },
            ".chosen-select-width": {
                width: "95%"
            }
        };

        for (var selector in config) {
            $(selector).chosen(config[selector]);
        }

       
        $("#submit").on("click", function (event) {
            event.preventDefault();

            console.log("hello")

            var userData = {
                name: $("#name").val(),
                photo: $("#photo").val(),
                scores: [
                    $("#q1").val(),
                    $("#q2").val(),
                    $("#q3").val(),
                    $("#q4").val(),
                    $("#q5").val(),
                    $("#q6").val(),
                    $("#q7").val(),
                    $("#q8").val(),
                    $("#q9").val(),
                    $("#q10").val()
                ]


            };


           

            var currentURL = window.location.origin;

            var yourEntryScores = userData.scores;

            $.post(currentURL + "/api/friends", userData,
                function (data) {
                    var arrayOfDifferences = [];
                    var totalDifference=0;
                    var smallestIndex;

                    // if (data == true) {
                   
                    //    }

                    console.log("Data" + data)

                    function getCompData() {

                        var currentURL = window.location.origin;

                        $.ajax({ url: currentURL + "/api/friends", method: "GET" })
                            .done(function (friendOptions) {



                                $(document).ready(function () {



                                    var arr = friendOptions;



                                    $.each(arr, function (index, value) {

                                        var currentComparison = value.scores;


                                        $.each(currentComparison, function (index, value) {


                                          var num1= yourEntryScores[index];
                                          var num2= currentComparison[index];
                                          var difference = Math.sqrt((num1-num2)*(num1-num2)); 
                                          totalDifference = totalDifference + difference;
                                          
                                          if (index == 9) {
                                              arrayOfDifferences.push(totalDifference);
                                              totalDifference = 0;


                                          }else {}   

                                        });

                                    });

                                    console.log("Data from the entry just made" + userData.scores);

                                    console.log("1st friend Options scores " + friendOptions[0].scores)

                                    console.log("arrayOfDifferences " + arrayOfDifferences)

                                    var differencesWithoutYou = arrayOfDifferences.pop();

                                    console.log("Array Without Last Entry" + arrayOfDifferences);

                                    var minimum = Math.min(...arrayOfDifferences)

                                    console.log("lowest difference "+ Math.min(...arrayOfDifferences));

                                    var relevantIndex = arrayOfDifferences.indexOf(minimum);

                                    console.log("Index of Lowest Difference " + relevantIndex);

                                     console.log(" scores of Match " + friendOptions[relevantIndex].scores)

                                    var matchedName = friendOptions[relevantIndex].name; 

                                    var matchedPhoto = friendOptions[relevantIndex].photo;

                                    console.log("Relevant stats " + matchedName + " " + matchedPhoto)

                                    var percentMatch = (100 - minimum);





                                    $("#match-name").empty();


                                        var getDiv = $("#match-name");

                        
                                        var percentDiv = $("<div>");
                                        var sportsDiv = $("<div>");

                                        
                                        var pp = $("<p>").text(percentMatch+"% Match");    
                                        var p = $("<p>").text("Meet ''" + matchedName +"''");
                                        percentDiv.append(pp);
                                        sportsDiv.append(p);
                                        getDiv.append(percentDiv);
                                        getDiv.append(sportsDiv);

                                    
                                      $("#match-img").empty();
                                    
                                        var getImg = $("#match-img");


                                    getImg.attr("src", matchedPhoto);





                                });





                               
                                

                            })
                            

                    }

                    getCompData();


                });


function showModal(){
              $("#matchModal").modal("show");
}

setTimeout(showModal,500);

        });




    </script>

</body>

</html>